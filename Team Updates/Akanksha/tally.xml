import re

def clean_tally_xml(input_path, output_path):
    with open(input_path, "rb") as f:
        raw = f.read()

    # 1️⃣ Remove invalid raw control characters
    cleaned = re.sub(
        b'[\x00-\x08\x0B\x0C\x0E-\x1F]',
        b'',
        raw
    )

    text = cleaned.decode("utf-8", errors="ignore")

    # 2️⃣ Remove invalid numeric character references (&#4;, &#x04;)
    text = re.sub(r'&#x?[0-9A-Fa-f]+;', '', text)

    with open(output_path, "w", encoding="utf-8") as f:
        f.write(text)
